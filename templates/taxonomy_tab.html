{% extends "base.html" %}
{% set active_tab = "taxonomy" %}

{% block content %}
<div class="container taxonomy-container">
    {% if not loaded %}
    <div class="upload-section">
        <h2>Taxonomy</h2>
        <p class="text-muted">Upload a data file on the
           <a href="{{ url_for('data_tab') }}">Data tab</a> to begin building a taxonomy.</p>
    </div>

    {% else %}
    <div class="taxonomy-toolbar">
        <h2>Taxonomy</h2>
        <div class="toolbar-actions">
            <button class="btn btn-primary" id="btn-add-subconcept" disabled>Add Subconcept</button>
            <button class="btn btn-secondary" id="btn-complement" disabled>Complement</button>
            <button class="btn btn-secondary" id="btn-union" disabled>Union</button>
            <button class="btn btn-secondary" id="btn-intersection" disabled>Intersection</button>
            <button class="btn btn-secondary" id="btn-delete" disabled>Delete</button>
            <button class="btn btn-secondary" id="btn-reset-taxonomy">Reset</button>
        </div>
    </div>

    <div class="taxonomy-layout">
        <div class="taxonomy-graph-panel">
            <div id="cy" class="cytoscape-container"></div>
        </div>
        <div class="taxonomy-detail-panel" id="detail-panel">
            <div class="detail-placeholder">
                <p class="text-muted">Select a concept to view details</p>
            </div>
        </div>
    </div>

    <!-- Modal: Add Subconcept -->
    <div class="modal-overlay" id="modal-add-subconcept" hidden>
        <div class="modal-dialog">
            <div class="modal-header">
                <h3>Add Subconcept</h3>
                <button class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Name (optional):</label>
                    <input type="text" id="subconcept-name" class="form-input" placeholder="Concept name">
                </div>
                <div id="restrictions-builder"></div>
                <button class="btn btn-secondary btn-sm" id="btn-add-restriction-row">+ Add Restriction</button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button class="btn btn-primary" id="btn-confirm-subconcept">Create</button>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{% if loaded %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
<script src="{{ url_for('static', filename='js/taxonomy_tab.js') }}"></script>
{% endif %}
{% endblock %}
