{% extends "base.html" %}
{% set active_tab = "data" %}

{% block content %}
<div class="container">
    {% if not loaded %}
    <div class="upload-section">
        <h2>Upload Data File</h2>
        <p>Upload a tabular data file (CSV, TSV, Excel, or JSON) to begin analysis.</p>
        <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" class="upload-form">
            <div class="form-group">
                <input type="file" name="file" accept=".csv,.tsv,.xlsx,.xls,.json" required>
            </div>
            <button type="submit" class="btn btn-primary">Upload</button>
        </form>
    </div>

    {% else %}
    <div class="file-info">
        <h2>{{ filename }}</h2>
        <div class="file-stats">
            <span class="stat">{{ row_count }} rows</span>
            <span class="stat">{{ col_count }} columns</span>
            <span class="stat"><span id="encoded-col-count">{{ encoded_col_count }}</span> encoded features</span>
        </div>
        <form action="{{ url_for('reset_data') }}" method="post" class="reset-form">
            <button type="submit" class="btn btn-secondary">Upload New File</button>
        </form>
    </div>

    <div id="columns-container">
        {% for col in columns %}
        <div class="column-card" id="col-card-{{ loop.index0 }}" data-column="{{ col.column_name }}">
            <div class="column-header">
                <h3 class="column-name">{{ col.column_name }}</h3>
                <span class="detected-badge" title="Auto-detected type">{{ col.detected_type }}</span>
            </div>
            <div class="column-controls">
                <div class="control-group">
                    <label>Type:</label>
                    <select class="col-type-select" data-column="{{ col.column_name }}">
                        <option value="numeric" {% if col.user_type == 'numeric' %}selected{% endif %}>Numeric</option>
                        <option value="categorical" {% if col.user_type == 'categorical' %}selected{% endif %}>Categorical</option>
                        <option value="date" {% if col.user_type == 'date' %}selected{% endif %}>Date</option>
                        <option value="title_id" {% if col.user_type == 'title_id' %}selected{% endif %}>Title / ID</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>
                        <input type="checkbox" class="col-include-check"
                               data-column="{{ col.column_name }}"
                               {% if col.include %}checked{% endif %}>
                        Include in analysis
                    </label>
                </div>
            </div>
            <div class="summary-content">
                {{ render_summary(col.summary, col.user_type) }}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{% if loaded %}
<script src="{{ url_for('static', filename='js/data_tab.js') }}"></script>
{% endif %}
{% endblock %}
